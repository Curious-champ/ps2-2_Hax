import socketio
from random import choice, randint, choices

false_attacks={
    
    "dos_goldeneye":[
        [80,7,6,381,11632,381,0,54.42857143,144.0044642,5792,0,1938.666667,2544.918912,5792,0,858.0714286,1855.776448,3443906.225,232,200,32,1,0,0,924.0769231,29200,235,0,0,0,0,54.42857143,1938.666667,381,11632,7,6],
        [80,7,5,414,11632,414,0,59.14285714,156.4772918,7288,0,2326.4,3351.290617,7288,0,926.6153846,2254.526319,5082888.923,232,168,32,1,0,0,1003.833333,29200,235,0,0,0,0,59.14285714,2326.4,414,11632,7,5],
        [80,8,6,325,11632,325,0,40.625,114.9048519,5792,0,1938.666667,2544.918912,5792,0,797.1333333,1802.932804,3250566.695,264,200,32,1,0,0,854.0714286,29200,235,0,0,0,0,40.625,1938.666667,325,11632,8,6],
        [80,8,5,537,11632,537,0,67.125,189.8581707,10184,0,2326.4,4437.056321,10184,0,869.2142857,2710.683427,7347804.643,264,168,32,1,0,0,936.0769231,29200,235,0,0,0,0,67.125,2326.4,537,11632,8,5],
        [80,8,6,308,11632,308,0,38.5,108.8944443,5840,0,1938.666667,2550.37524,5840,0,796.0,1806.007119,3261661.714,264,200,32,1,0,0,852.8571429,29200,235,0,0,0,0,38.5,1938.666667,308,11632,8,6],
        [80,8,6,411,11632,411,0,51.375,145.3104435,5792,0,1938.666667,2544.918912,5792,0,802.8666667,1801.460315,3245259.267,264,200,32,1,0,0,860.2142857,29200,235,0,0,0,0,51.375,1938.666667,411,11632,8,6],
        [80,8,6,279,11632,279,0,34.875,98.64139598,4392,0,1938.666667,2190.718847,4392,0,794.0666667,1629.340992,2654752.067,264,200,32,1,0,0,850.7857143,29200,235,0,0,0,0,34.875,1938.666667,279,11632,8,6],
        ],
    
    "heartbleed":[
        [444,2685,1729,8299,7556917,517,0,3.090875233,16.85842056,17376,0,4370.686524,2566.935004,17376,0,1713.525708,2669.389319,7125639.337,85928,55336,32,118,0,0,1713.91391,29200,235,0,0,0,0,3.090875233,4370.686524,8299,7556917,2685,1729],
        [444,2792,2110,13712,7878135,5792,0,4.911174785,110.3764478,14480,0,3733.71327,2366.09794,14480,0,1610.776871,2414.090913,5827834.935,89356,67520,32,120,0,0,1611.105467,235,235,0,0,0,0,4.911174785,3733.71327,13712,7878135,2792,2110],
        [444,2794,2130,12264,7879536,4344,0,4.38940587,83.21163543,13032,0,3699.312676,2314.906035,13032,0,1603.27797,2381.909586,5673493.274,89408,68160,32,120,0,0,1603.603574,235,235,0,0,0,0,4.38940587,3699.312676,12264,7879536,2794,2130],
        [444,2791,2114,13712,7878088,5792,0,4.912934432,110.3961875,13032,0,3726.626301,2284.046514,13032,0,1609.782307,2377.954578,5654667.975,89312,67648,32,120,0,0,1610.110499,235,235,0,0,0,0,4.912934432,3726.626301,13712,7878088,2791,2114],
        [444,2782,2089,9368,7882432,1448,0,3.36736161,30.50502966,17376,0,3773.303973,2372.06653,17376,0,1620.124795,2427.68666,5893662.519,89024,66848,32,120,0,0,1620.457401,235,235,0,0,0,0,3.36736161,3773.303973,9368,7882432,2782,2089],
    ]
        }

def choose_random_attack(attacks=false_attacks):
    attack_type=choice(list(attacks.keys()))
    attack=choice(attacks[attack_type])
    return attack_type, attack

class Client:
    def __init__(self, port):
        self.sio = socketio.Client()

        @(self.sio).event
        def connect():
            print('CICFlowMeter connected to server')

        self.connectToServer(port)

    def sendToServer(self, func, data,generate_false_attacks):

        if generate_false_attacks and (choices([0,1],weights=[0.7,0.3])[0]):
            number_of_false_attacks=randint(0,5)
            for i in range(number_of_false_attacks):
                attack_type, attack=choose_random_attack(false_attacks)
                data["data"].append(attack)


        if len(data["data"]) !=0:
            self.sio.emit(func, data)
        

    def connectToServer(self, port):
        self.sio.connect(f'http://localhost:{port}')

    def disconnectFromServer(self):
        self.sio.disconnect()

    # events..


if __name__ == '__main__':
    connection = Client(8001)
    connection.sendToServer("CicFlowMeter", {
                    "columns": "dst_port", "data":80})
    # connection.sio.wait()


    # connection.sio.sleep(1)
    # connection.disconnectFromServer()

